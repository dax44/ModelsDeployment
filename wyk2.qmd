---
title: "Wykad 2"
author: "Dariusz Majerek"
format: html
execute: 
  echo: true
  warning: false
embed-resources: false
editor_options: 
  chunk_output_type: console
---

# Kontynuacja pracy z Git i GitHub

Przypominajc sytuacj w jakiej si znajdujemy... utworzylimy repozytorium o
nazwie `DariuszMajerek/Github_tests`. Dokonalimy w nim kilku zmian
commitowanych za ka偶dym razem. Podgld tych zmian mo偶emy dokona przez przegld
commit贸w.

```{bash}
git log
```

![Logi z commit](images/Zrzut%20ekranu%202024-01-6%20o%2012.58.33.png)

## Fork repo

Zmian mo偶emy dokonywa r贸wnie偶 w repo, kt贸rych autorem jest kto inny. Najpierw
nale偶y wykona `fork` takiego repo, a nastpnie dokona zmian. Dokonamy
najpierw forka przykadowego repo `octocat/Spoon-Knife`[^1]. Mo偶na tego dokona
na stronie repo klikn przycisk `fork`

![](images/Zrzut%20ekranu%202024-01-6%20o%2013.08.25.png)

Zostaniesz w贸wczas zapytany czy chcesz skopiowa jedynie g贸wn ga藕 repo i
pod jak nazw chcesz go skopiowa.

![](images/Zrzut%20ekranu%202024-01-6%20o%2013.13.16.png)

Wybranie opcji domylnych jest zalecane, jeli chcemy dokona p贸藕niej tzw pull
request (o tym za chwil). Po skopiowaniu fork cudzego repo na moim koncie
GitHub wyglda nastpujco. Pod nazw repo widnieje nazwa repo skd zostao ono
skopiowane.

![](images/Zrzut%20ekranu%202024-01-6%20o%2013.13.38.png)

Kopiowanie czyjego repo robimy kiedy chcemy zmodyfikowa kod istniejcy bez
ingerencji w oryginalny kod (oryginalny stan repo) a nastpnie go
(poprawionego) wypchn. P贸ki co fork czyjego repo znajduje si jedynie w
naszym repo zdalnym. Aby pobra go do repo lokalnego, trzeba wykona
nastpujce czynnoci:

1.  przej do katalogu, w kt贸rym chcemy zapisa kopi repo
2.  skopiowa adres dostpu do kopiowanego repo (HTTPS lub SSH)
3.  wykona polecenie `git clone <forked_repo_url>`, gdzie `<forked_repo_url>`
    oznacza wanie skopiowany adres repo.

```{bash}
# najpierw sprawd藕 miejsce w kt贸rym si znajdujesz (katalog roboczy)
pwd

# przejd藕 do katalogu wy偶ej (tam chc skopiowa repo)
cd ..

# sklonuj forka repo
git clone git@github.com:DariuszMajerek/Spoon-Knife.git
```

![](images/Zrzut%20ekranu%202024-01-6%20o%2013.31.34.png)

::: callout-warning
Zn贸w czujne oko wychwyci, 偶e podajc adres repo zmieniem go z
`git@github.com:DariuszMajerek/Spoon-Knife.git` na
`git@github.com-work:DariuszMajerek/Spoon-Knife.git`, to dlatego, 偶e na
komputerze, na kt贸rym to robi mam poczone dwa konta GitHub i aby je
rozr贸偶nia stosuj tak podmian.
:::

Po skopiowaniu repo na dysk lokalny, mo偶emy przystpi do dokonywania
modyfikacji w repo. Na potrzeby przykadu zmienimy wartoci w pliku
`style.css`. W czci dotyczcej stylu paragrafu zmienimy dwie wartoci:

-   oryginalne wartoci

```         
p {
  display: block;
  width: 400px;
  margin: 50px auto;
  font: 30px Monaco,"Courier New","DejaVu Sans Mono","Bitstream Vera Sans Mono",monospace;
}
```

-   wartoci po zmianach

```         
p {
  display: block;
  width: 500px;
  margin: 50px auto;
  font: 20px Monaco,"Courier New","DejaVu Sans Mono","Bitstream Vera Sans Mono",monospace;
}
```

```{bash}
# sprawd藕my czy zmiany zostay zarejestrowane
git status

# mo偶emy ponadto podejrze zmiany za pomoc
git diff
```

![](images/Zrzut%20ekranu%202024-01-6%20o%2013.50.02.png)

Teraz zmiany trzeba zatwierdzi i commitowa.

```{bash}
git add .
git commit -m "style changes"
```

Nastpnie wypychamy zmiany do zdalnego repo. Najpierw mo偶emy sprawdzi czy
adres zdalnego repo jest ustalony.

```{bash}
# sprawdzamy czy adres zdalenego repo istnieje
git remote -v

# skoro tak to wypychamy g贸wn ga藕 do repo zdalnego
git push origin main
```

![](images/Zrzut%20ekranu%202024-01-6%20o%2013.56.39.png)

Teraz zar贸wno repo lokalne, jak i zdalne maj t sam zawarto i t sam
wersj. Czciej jednak w tego typu wsp贸pracy nad kodem umieszczonym w repo
bdziemy tworzyli wasn ga藕 w forkowanym repo.

::: callout-caution
Za ka偶dym razem, gdy pracujesz nad wsp贸lnym projektem, ty i inni programici
wsp贸tworzcy repozytorium bdziecie mieli r贸偶ne pomysy na nowe funkcje lub
poprawki jednoczenie. Niekt贸re z tych nowych funkcji nie zajm du偶o czasu na
wdro偶enie, ale niekt贸re z nich bd trway. Z tego powodu wa偶ne jest
rozgazienie repozytorium, aby m贸c zarzdza przepywem pracy, izolowa sw贸j
kod i kontrolowa, kt贸re funkcje wracaj do g贸wnej gazi repozytorium
projektu.
:::

[^1]: Ewentualne zmiany nie popsuj niczego w tym repo, bo jest ono
    przygotowane do tego typu test贸w.

## Kontrola wersji - cofanie zmian

W tym celu najpierw nauczymy si cofa zmiany dokonane zar贸wno w repo lokalnym
i zdalnym. Zacznijmy od sprawdzenia log贸w repo.

```{bash}
git log
```

![](images/Zrzut%20ekranu%202024-01-6%20o%2014.21.52.png)

Wida, 偶e opr贸cz trzech zmian repo dokonanych przez autora (octocat) jest
zmiana stylu dokona przeze mnie. Logi s zawsze wywietlane w kolejnoci od
najaktualniejszego (na g贸rze) do najstarszego (na dole). Mo偶emy si cofn do
stanu zachowanego dowolnym commitem .

Cofanie stanu repo mo偶na wykona na dwa sposoby:

-   poprzez `git reset`
-   oraz `git revert`

Dziaanie obu tych funkcji r贸偶ni si nieco i obie je om贸wimy.

### Reset

Polecenie `git reset` su偶y do cofnicia zmian w katalogu roboczym i powrotu do
okrelonego zatwierdzenia, jednoczenie odrzucajc wszystkie zatwierdzenia
wykonane po nim. Na przykad, wyobra藕 sobie, 偶e wykonae dziesi commit贸w.
U偶ycie `git reset` na pierwszym zatwierdzeniu usunie wszystkie dziewi
zatwierdze, przenoszc ci z powrotem do etapu pierwszego zatwierdzenia. Przed
u偶yciem `git reset` wa偶ne jest, aby wzi pod uwag rodzaj zmian, kt贸re
planujesz wprowadzi; w przeciwnym razie stworzysz wicej chaosu ni偶 po偶ytku.

::: callout-important
Mo偶esz u偶y wielu opcji wraz z `git reset`, ale to s te g贸wne. Ka偶da z nich
jest u偶ywana w zale偶noci od konkretnej sytuacji: `git reset --soft`,
`git reset --mixed` i `git reset --hard`.
:::

Flaga `--soft` ma na celu zmian odniesienia `HEAD` (stanu gdzie znajduje si
ostatni commit na komputerze lokalnym) do okrelonego commita. Na przykad,
jeli zdamy sobie spraw, 偶e zapomnielimy doda plik do commita, mo偶emy cofn
si za pomoc `--soft` w nastpujcy spos贸b:

-   `git reset --soft HEAD~n` aby cofn si do zatwierdzenia z okrelonym
    odniesieniem (n).
-   `git reset --soft HEAD~1` cofa do ostatniego zatwierdzenia.
-   `git reset --soft <commit ID>` cofa `HEAD` do `<commit ID>`

gdzie `<commit ID>` jest tagiem commita. Opcja `--soft` nie wymaga ponownego
dodawania plik贸w, kt贸re zostay dodane w poprzednim commicie.

![Przykad u偶ycia git reset --soft
HEAD](images/Zrzut%20ekranu%202024-01-6%20o%2016.44.54.png)

Flaga `--mixed` jest domylnym ustawieniem polecenia `git reset`. Uruchomienie
tego polecenia ma dwa skutki:

1.  od-commituje wszystkie zmiany
2.  usuwa je ze *Stage*

U偶ywamy jej gdy np. w commitowanym stanie repo uznalimy, 偶e nie warto go
wypycha, poniewa偶 jeden z plik贸w, kt贸ry commitujemy ma jeszcze bdy i nale偶y
go poprawi przed `git push`.

![Przykad u偶ycia git reset --mixed
HEAD](images/Zrzut%20ekranu%202024-01-6%20o%2016.47.04.png)

Flaga `--hard` powinna by u偶ywana z rozmysem, poniewa偶 mo偶e wyrzdzi sporo
szk贸d. Opcja `--hard` odrzuca wszelkie zmiany dokonane w ledzonych plikach w
katalogu roboczym i resetuje je do stanu okrelonego commita.

![Przykad u偶ycia git reset --hard
HEAD](images/Zrzut%20ekranu%202024-01-6%20o%2016.48.54.png)

![Schemat dziaania git reset](images/git_reset.webp)

### Revert

Polecenie `git revert` su偶y do utworzenia nowego commitu, kt贸ry cofa zmiany
wprowadzone w okrelonym poprzednim commicie. W przeciwiestwie do `git reset`,
kt贸re przemieszcza wska藕nik HEAD i gazi do innego commitu, `git revert`
tworzy nowy commit, kt贸ry odwraca zmiany w poprzednim commicie.

Poka偶 to na przykadzie, korzystajc z wczeniejszego scenariusza z trzema
commitami i trzema plikami (`plik1.txt`, `plik2.txt`, `plik3.txt`).

![Przykad u偶ycia git
revert](images/Zrzut%20ekranu%202024-01-6%20o%2017.09.51.png)

Po u偶yciu `git revert` nie ma 偶adnych niezatwierdzonych zmian. Wprowadza nowy
commit, kt贸ry cofa zmiany wprowadzone w poprzednim commicie. Dziki temu mo偶emy
utrzyma sp贸jno historii i unikn problem贸w z innymi wsp贸pracownikami,
kt贸rzy ju偶 pobrali nasze zmiany.

R贸偶nice midzy `git revert` a `git reset`:

-   `git revert` wprowadza nowy commit, zachowujc histori.
-   `git reset` przemieszcza wska藕nik HEAD, usuwajc zmiany z historii.
-   `git revert` jest bezpieczniejsze do stosowania w publicznych
    repozytoriach, poniewa偶 nie wymaga modyfikowania historii, co mo偶e utrudni
    wsp贸prac z innymi programistami.

![Schemat dziaania git
revert](images/Zrzut%20ekranu%202024-01-6%20o%2017.12.34.png)

Teraz mo偶emy wr贸ci do zadania usunicia zmian (ostatniego commita) w repo
`DariuszMajerek/Spoon-Knife`. Musimy wykona nastpujce czynnoci w katalogu
Spoon-Knife.

Jeli chcesz przej do wczeniejszej wersji zdalnego repozytorium w tej samej
gazi i usun najnowsze commity, mo偶na skorzysta z polecenia `git reset` w
trybie `--hard`. Jednak pamitaj, 偶e `git reset --hard` jest operacj radykaln
i trwale usuwa commity, wic bd藕 pewien, 偶e chcesz to zrobi, poniewa偶
stracisz histori tych commit贸w.

Oto kroki, kt贸re mo偶esz podj:

1.  Sprawd藕 dostpne gazie zdalne:

``` bash
git branch -r
```

2.  Pobierz najnowsze zmiany z repozytorium zdalnego:

``` bash
git fetch origin
```

3.  Przejd藕 do gazi, w kt贸rej chcesz cofn zmiany:

``` bash
# to nie jest konieczne bo ju偶 jestemy w tej gazi
# ale nie zawsze tak bdzie
git checkout main
```

4.  Zidentyfikuj commit, do kt贸rego chcesz si cofn:

``` bash
git log
```

Odnajd藕 hasz commitu, do kt贸rego chcesz si cofn.

5.  U偶yj `git reset --hard` do cofnicia zmian:

``` bash
git reset --hard hasz-commitu
```

Zastp `hasz-commitu` odpowiednim hasem commitu, do kt贸rego chcesz si cofn.

6.  Przesu zmiany na repozytorium zdalne:

``` bash
git push origin main --force
```

Uwaga: U偶ycie `--force` jest konieczne, poniewa偶 zmieniasz histori i wymagane
jest przeforsowanie zmian na repozytorium zdalne. Jednak bd藕 bardzo ostro偶ny,
u偶ywajc `--force`, poniewa偶 mo偶e to wpyn na innych wsp贸pracownik贸w
korzystajcych z tej gazi.

![Przejcie do stanu z wczeniejszego
commita](images/Zrzut%20ekranu%202024-01-6%20o%2019.46.35.png)

W ten spos贸b wr贸cilimy do oryginalnego stanu pobranego repo
`octocat/Spoon-Knife`. Mo偶emy teraz przystpi do tworzenia wasnej gazi w
tym repo i dokonania w nim zmian. Na kocu bdziemy chcieli dokona czenia
gazi (naszej po poprawkach) z oryginaln poprzez *pull request*.

## Dziaanie na gaziach

```{bash}
# zaczynamy od sprawdzenia w kt贸rej gazi jestemy
git branch

# teraz tworzymy now ga藕 w obecnej
git branch my_branch

# teraz do niej przechodzimy
git checkout my_branch

# dwie ostatnie czynnoci mo偶na wykona jedn komend
git checkout -b my_branch
```

Teraz dokonujemy tych samych zmian w pliku `styles.css`, kt贸rych dokonalimy w
gazi g贸wnej.

```{bash}
# po zmianach sprawdzamy status repo w gazi my_branch
git status

# wida 偶e zmiany nastpiy wic je dodajemy do Stage
git add styles.css

# commitujemy zmiany
git commit -m "style changes"

# wypychamy zmiany/commita do nowej gazi
git push origin my_branch
```

![Przebieg pracy nad utworzeniem nowej gazi i dodaniem do niej
zmian](images/Zrzut%20ekranu%202024-01-6%20o%2020.02.31.png)

Jak mo偶na zauwa偶y na powy偶szym obrazku system sugeruje dokonanie *pull
request,* czyli proby (w tym przypadku skierowanej do octocat) o poczenie
(czyli *merge*) gazi g贸wnej z gazi `my_branch`.

Aby dokona *pull request* nowej gazi w systemie Git, zazwyczaj korzysta si
z platformy do zarzdzania kodem, takiej jak GitHub, GitLab lub Bitbucket.
Poni偶ej przedstawiam og贸lny przewodnik krok po kroku, korzystajc z GitHuba
jako przykadu. Procedury na innych platformach s zbli偶one, ale mog si
r贸偶ni w szczeg贸ach.

1.  Utw贸rz now ga藕 w lokalnym repozytorium:

    ``` bash
    git checkout -b nazwa-nowej-gazi
    ```

    Wykonaj prac na tej gazi i zatwierdzaj zmiany.

2.  Push nowej gazi na repozytorium zdalne:

    ``` bash
    git push origin nazwa-nowej-gazi
    ```

    To przesya now ga藕 na repozytorium zdalne[^2].

3.  Otw贸rz przegldark i przejd藕 do repozytorium na GitHubie.

4.  Przejd藕 do nowej gazi - w zakadce "Branch" na stronie repozytorium,
    wybierz now ga藕.

5.  Utw贸rz Pull Request:

    -   Na stronie gazi wybierz przycisk "New pull request".
    -   Wybierz ga藕 docelow, zazwyczaj jest to `master` lub inna g贸wna
        ga藕.

6.  Uzupenij informacje dotyczce Pull Request:

    -   Uzupenij tytu i opis dotyczcy zmiany, kt贸re wprowadzie.
    -   Sprawd藕, czy Pull Request spenia oczekiwania dotyczce kodu i test贸w.

7.  Utw贸rz Pull Request - kliknij przycisk "Create pull request", aby utworzy
    Pull Request.

8.  Dokonaj przegldu i zatwierd藕:

    -   Inni czonkowie zespou mog dokona przegldu zmian.
    -   Po zakoczonym przegldzie i zatwierdzeniu zmian, Pull Request mo偶e by
        scalony (merged).

9.  Zaktualizuj lokalne repozytorium - po scaleniu Pull Requesta na
    repozytorium zdalnym, zaktualizuj swoje lokalne repozytorium:

    ``` bash
    git checkout master
    git pull origin master
    ```

    W ten spos贸b przyniesiesz zmiany z gazi docelowej (np. `master`) do
    swojego lokalnego repozytorium.

{{< video images/PullRequest.mp4 >}}

[^2]: Dotd mamy wszystko zrobione
